<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Board Parts ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&amp;display=swap" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <link href="https://ai-public.creatie.ai/gen_page/tailwind-custom.css" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com/3.4.5?plugins=forms@0.5.7,typography@0.5.13,aspect-ratio@0.4.2,container-queries@0.1.1"></script>
    <script>
        // ë‹¤í¬ëª¨ë“œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <script src="https://ai-public.creatie.ai/gen_page/tailwind-config.min.js" data-color="#FFA500" data-border-radius="small"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.5.0/echarts.min.js"></script>
    <style>
        :root {
            --custom-color: #e65802; /* ë°ì€ ì˜¤ë Œì§€ìƒ‰ */
        }
        .bg-custom {
            background-color: var(--custom-color);
        }
        .text-custom {
            color: var(--custom-color);
        }
        .border-custom {
            border-color: var(--custom-color);
        }
        .focus\:border-custom:focus {
            border-color: var(--custom-color);
        }
        .focus\:ring-custom:focus {
            box-shadow: 0 0 0 3px rgba(255, 165, 0, 0.5);
        }
        .button {
            display: inline-block;
            padding: 10px 20px;
            background-color: #e65802;
            color: black;
            text-decoration: none;
            border-radius: 5px;
            text-align: center;
        }
        .button:hover {
            background-color: #FFA500;
        }
        #darkModeToggle {
            transition: all 0.3s ease;
        }
        #darkModeToggle:hover {
            transform: rotate(15deg);
        }
        .dark #darkModeToggle:hover {
            transform: rotate(-15deg);
        }
        
        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ ì¶”ê°€ - ê°•ë ¥í•œ ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .dark {
            color-scheme: dark;
        }
        
        .dark body {
            background-color: #121212 !important;
            color: #ffffff !important;
        }

        .dark .bg-orange-50,
        .dark .bg-orange-100,
        .dark .bg-white {
            background-color: #1e1e1e !important;
            color: #f0f0f0 !important;
        }

        .dark h1, .dark h2, .dark h3, .dark p, 
        .dark label, .dark text, .dark div {
            color: #f0f0f0 !important;
        }
        
        .dark input, .dark select, .dark textarea {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border-color: #444444 !important;
        }
        
        .dark .shadow, .dark .shadow-lg, .dark .shadow-sm {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5) !important;
        }

        /* ì‚¬ì´ë“œë°” ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .dark aside.w-64 {
            background-color: #374151 !important; /* bg-gray-700ê³¼ ë™ì¼í•œ ìƒ‰ìƒ */
        }

        .dark .button {
            background-color: #374151 !important; /* bg-gray-700ê³¼ ë™ì¼ */
            color: #f3f4f6 !important; /* í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
        }

        .dark .button:hover {
            background-color: #4b5563 !important; /* bg-gray-600ê³¼ ë™ì¼ */
        }

        .dark .button.bg-yellow-500 {
            background-color: #4338ca !important; /* ì„ íƒëœ ë²„íŠ¼ì€ ì¸ë””ê³ -700ìœ¼ë¡œ */
            color: #f3f4f6 !important;
        }

        /* ë‹¤í¬ëª¨ë“œì—ì„œ ì±„íŒ… íˆìŠ¤í† ë¦¬ í…Œì´ë¸” í…ìŠ¤íŠ¸ ê°•ì œ í°ìƒ‰ */
        .dark .dark\:bg-gray-900 td {
            color: white !important;
            font-weight: 500 !important;
        }

        .dark #chatHistoryTable td {
            color: white !important;
            font-weight: 500 !important;
        }

    </style>
</head>
<body class="min-h-screen bg-orange-50 dark:bg-orange-100">
    <div class="flex h-screen overflow-hidden">
        <aside class="w-64 bg-orange-600 text-white dark:bg-orange-500">
            <a href="#" id="homeRefreshButton" class="block text-center p-2 hover:bg-orange-700 transition-all duration-300">
                <img src="nepesark_2-removebg-preview.png" alt="HOME" class="h-30 w-auto transition-transform duration-300 hover:scale-105" />
            </a>
            <a href="index.html" class="button w-full text-left bg-yellow-500 text-black mb-1">ğŸ“™ Parts ì¬ê³ ê´€ë¦¬</a>
            <a href="Parts_ì…ì¶œê³ .html" class="button w-full text-left bg-orange-500 hover:bg-yellow-500 text-black mb-1">ğŸšš Parts ì…ì¶œê³  ì´ë ¥</a>
            <a href="ì¬ê³ ëª©ë¡.html" class="button w-full text-left bg-orange-500 hover:bg-yellow-500 text-black mb-1">ğŸ“Š ì¬ê³ ëª©ë¡ ê´€ë¦¬</a>
        </aside>
        <main class="flex-1 overflow-y-auto">
            <header class="bg-orange-100 shadow-sm dark:bg-orange-200">
                <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
                    <div class="flex justify-between items-center">
                        <h1 class="text-2xl font-semibold text-orange-900 dark:text-orange-800">ì¥ë¹„ì†”ë£¨ì…˜ íŒŒíŠ¸ Board Parts ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                        <div class="flex items-center space-x-4">
                            <!-- ì‚¬ìš©ì ì •ë³´ í‘œì‹œ -->
                            <div class="flex items-center space-x-2">
                                <span id="currentUser" class="text-sm text-orange-700 dark:text-orange-800">ë¡œë”© ì¤‘...</span>
                                <button onclick="logout()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    <i class="fas fa-sign-out-alt mr-1"></i>ë¡œê·¸ì•„ì›ƒ
                                </button>
                            </div>
                            <!-- ë‚ ì§œ ë²”ìœ„ í•„í„° ì¶”ê°€ -->
                            <div class="flex items-center space-x-2 bg-orange-200 dark:bg-orange-700 rounded-lg p-2">
                                <i class="fas fa-calendar-alt text-orange-800 dark:text-orange-200"></i>
                                <input type="date" id="startDateFilter" class="text-sm border-none bg-transparent text-orange-800 dark:text-orange-200 focus:outline-none cursor-pointer" title="ì‹œì‘ ë‚ ì§œ">
                                <span class="text-orange-800 dark:text-orange-200">~</span>
                                <input type="date" id="endDateFilter" class="text-sm border-none bg-transparent text-orange-800 dark:text-orange-200 focus:outline-none cursor-pointer" title="ì¢…ë£Œ ë‚ ì§œ">
                                <button id="applyDateFilter" class="bg-orange-500 hover:bg-orange-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ì ìš©
                                </button>
                                <button id="resetDateFilter" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">
                                    ì´ˆê¸°í™”
                                </button>
                            </div>
                            
                            <button id="darkModeToggle" class="rounded-full p-2 bg-orange-200 hover:bg-orange-300 dark:bg-orange-700 dark:hover:bg-orange-600 transition-colors">
                                <!-- ë¼ì´íŠ¸ ëª¨ë“œì—ì„œëŠ” ë‹¬ ì•„ì´ì½˜, ë‹¤í¬ëª¨ë“œì—ì„œëŠ” í•´ ì•„ì´ì½˜ -->
                                <i id="moonIcon" class="fas fa-moon text-orange-800"></i>
                                <i id="sunIcon" class="fas fa-sun text-orange-800" style="display: none;"></i>
                            </button>

                            <div class="relative">
                                <button id="notificationButton" class="!rounded-button flex items-center text-orange-700 hover:text-orange-900 dark:text-orange-600 dark:hover:text-orange-800">
                                    <i class="fas fa-bell text-xl"></i>
                                </button>
                                <span id="notificationCounter" class="absolute -top-1 -right-1 bg-orange-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
                                
                                <!-- ì•Œë¦¼ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ ì¶”ê°€ -->
                                <div id="notificationDropdown" class="absolute right-0 mt-2 w-80 bg-white rounded-md shadow-lg overflow-hidden z-20 hidden dark:bg-gray-800">
                                    <div class="py-2 px-3 bg-orange-100 dark:bg-gray-700">
                                        <div class="flex justify-between items-center">
                                            <h3 class="text-sm font-medium text-orange-900 dark:text-gray-200">ì‹¤ì‹œê°„ ì•Œë¦¼</h3>
                                            <span id="dropdownNotificationCounter" class="bg-orange-500 text-white text-xs rounded-full px-2 py-1">0</span>
                                        </div>
                                    </div>
                                    <div id="notificationList" class="max-h-80 overflow-y-auto">
                                        <!-- ì•Œë¦¼ ëª©ë¡ì€ JavaScriptë¡œ ë™ì  ìƒì„±ë¨ -->
                                        <div class="text-center text-gray-500 dark:text-gray-400 py-6">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>
                                    </div>
                                    <div class="py-2 px-3 bg-gray-100 text-right dark:bg-gray-900">
                                        <button id="clearAllNotifications" class="text-xs text-orange-600 hover:text-orange-800 dark:text-orange-400 dark:hover:text-orange-300">ëª¨ë‘ í™•ì¸</button>
                                    </div>
                                </div>           
                            </div>
                            <!-- ë©”ì‹ ì € ì•„ì´ì½˜ -->
                            <div class="relative ml-4">
                                <button id="messengerButton" class="!rounded-button flex items-center text-orange-700 hover:text-orange-900 dark:text-orange-600 dark:hover:text-orange-800">
                                    <i class="fas fa-comment-dots text-xl"></i>
                                </button>
                                <span id="messageCounter" class="absolute -top-1 -right-1 bg-green-500 text-white text-xs rounded-full w-4 h-4 flex items-center justify-center">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>
            <div class="max-w-8xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                <div class="grid grid-cols-3 gap-6 mb-8">
                    <div class="bg-orange-50 rounded-lg shadow p-6 dark:bg-orange-100">
                        <h3 class="text-lg font-medium mb-4 dark:text-orange-900">ì¹´í…Œê³ ë¦¬ë³„ ì¶œê³  í˜„í™©</h3>
                        <div id="stockChart" class="h-64"></div>
                    </div>

                    <div class="bg-orange-50 rounded-lg shadow p-6 dark:bg-orange-100">
                        <h3 class="text-lg font-medium mb-4 dark:text-orange-900">ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë§¤ê¸ˆì•¡</h3>
                        <div id="flowChart" class="h-64"></div>
                    </div>

                    <div class="bg-orange-50 rounded-lg shadow p-6 dark:bg-orange-100">
                        <h3 class="text-lg font-medium mb-4 dark:text-orange-900">ì‹¤ì‹œê°„ ì•Œë¦¼</h3>
                        <div class="space-y-4">
                            <div class="flex items-start"><div class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-200 flex items-center justify-center"><i class="fas fa-box text-orange-600"></i></div><div class="ml-3"><p class="text-sm font-medium">TLP3914 ì¶œê³  ì²˜ë¦¬</p><p class="text-xs text-orange-500">2025-02-26</p></div></div>
                            <div class="flex items-start"><div class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-200 flex items-center justify-center"><i class="fas fa-box text-orange-600"></i></div><div class="ml-3"><p class="text-sm font-medium">R1005F/4.99K ì¶œê³  ì²˜ë¦¬</p><p class="text-xs text-orange-500">2025-02-27</p></div></div>
                            <div class="flex items-start"><div class="flex-shrink-0 w-8 h-8 rounded-full bg-orange-200 flex items-center justify-center"><i class="fas fa-box text-orange-600"></i></div><div class="ml-3"><p class="text-sm font-medium">22uF/35V ì¶œê³  ì²˜ë¦¬</p><p class="text-xs text-orange-500">2025-02-27</p></div></div>
                        </div>
                    </div>
                    
                </div>
                <div class="bg-orange-50 rounded-lg shadow dark:bg-orange-100">
                    
                </div>                <!-- Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ -->
                <div class="bg-orange-50 rounded-lg shadow p-6 dark:bg-orange-100 mb-8">
                    <h3 class="text-lg font-medium mb-4 dark:text-orange-900">Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰</h3>
                    
                    <!-- í•„í„° UI -->
                    <div class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label for="equipmentGroupFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">ì„¤ë¹„êµ°</label>
                            <select id="equipmentGroupFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">ì „ì²´ ì„¤ë¹„êµ°</option>
                            </select>
                        </div>
                        <div>
                            <label for="boardNameFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Boardëª…</label>
                            <select id="boardNameFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">ì „ì²´ Boardëª…</option>
                            </select>
                        </div>
                        <div>
                            <label for="serialNumberFilter" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">S/N</label>
                            <select id="serialNumberFilter" class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
                                <option value="">ì „ì²´ S/N</option>
                            </select>
                        </div>
                        <div class="flex items-end">
                            <button id="applyBoardFilter" class="w-full px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-orange-500">
                                í•„í„° ì ìš©
                            </button>
                        </div>
                    </div>
                    
                    <div id="integratedChart" class="h-96"></div>                </div>
                
            </div>
        </div>
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 w-96">
            <h2 class="text-lg font-semibold mb-4">ìƒˆ ë¶€í’ˆ ë“±ë¡</h2>
            <form id="partForm">
                <div class="mb-4">
                    <label for="location" class="block text-sm font-medium text-gray-700">ìœ„ì¹˜</label>
                    <input type="text" id="location" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-custom focus:border-custom" required>
                </div>
                <div class="mb-4">
                    <label for="name" class="block text-sm font-medium text-gray-700">í’ˆëª©</label>
                    <input type="text" id="name" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-custom focus:border-custom" required>
                </div>
                <div class="mb-4">
                    <label for="company" class="block text-sm font-medium text-gray-700">êµ¬ë§¤ì²˜</label>
                    <input type="text" id="company" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-custom focus:border-custom" required>
                </div>
                <div class="mb-4">
                    <label for="minStock" class="block text-sm font-medium text-gray-700">ìµœì†Œ ì¬ê³  ê°œìˆ˜</label>
                    <input type="number" id="minStock" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-custom focus:border-custom" min="1" step="1" required>
                </div>
                <div class="mb-4">
                    <label for="inDate" class="block text-sm font-medium text-gray-700">ì…ê³ ì¼</label>
                    <input type="date" id="inDate" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-custom focus:border-custom">
                </div>
                <div class="flex justify-end space-x-4">
                    <button type="button" id="cancelButton" class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400">ì·¨ì†Œ</button>
                    <button type="submit" class="px-4 py-2 bg-custom text-white rounded-md hover:bg-orange-700">ë“±ë¡</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- ì±„íŒ… ëª¨ë‹¬ (ì—¬ê¸°ì— ì¶”ê°€) -->
    <div id="chatModal" class="fixed bottom-4 right-4 w-96 bg-white rounded-lg shadow-lg overflow-hidden z-30 hidden dark:bg-gray-800">
        <div class="flex justify-between items-center bg-orange-500 dark:bg-orange-700 text-white p-3">
            <h3 class="font-medium">ì‹¤ì‹œê°„ ì±„íŒ…</h3>
            <div class="flex space-x-2">
                <button id="minimizeChatButton" class="hover:bg-orange-600 dark:hover:bg-orange-800 p-1 rounded">
                    <i class="fas fa-minus"></i>
                </button>
                <button id="closeChatButton" class="hover:bg-orange-600 dark:hover:bg-orange-800 p-1 rounded">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div id="chatMessages" class="h-80 overflow-y-auto p-4 space-y-3">
            <div class="flex flex-col space-y-1">
                <div class="flex items-end">
                    <div class="flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-start">
                        <div><span class="px-4 py-2 rounded-lg inline-block rounded-bl-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200">ì „ë‹¬ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”.</span></div>
                    </div>
                    <img src="https://via.placeholder.com/30" alt="ê´€ë¦¬ì" class="w-6 h-6 rounded-full order-1">
                </div>
            </div>
        </div>
        <div class="border-t border-gray-200 dark:border-gray-700 p-3">
            <div class="flex items-center space-x-2">
                <input type="text" id="chatInput" class="flex-1 border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-lg px-3 py-2 focus:outline-none focus:ring-1 focus:ring-orange-500" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”...">
                <button id="sendMessageButton" class="bg-orange-500 hover:bg-orange-600 text-white rounded-lg p-2 dark:bg-orange-700 dark:hover:bg-orange-800">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // ì•Œë¦¼ ë²„íŠ¼ ë° ë“œë¡­ë‹¤ìš´ ê¸°ëŠ¥
        function setupNotifications() {
            const notificationButton = document.getElementById('notificationButton');
            const notificationDropdown = document.getElementById('notificationDropdown');
            const notificationCounter = document.getElementById('notificationCounter');
            const dropdownNotificationCounter = document.getElementById('dropdownNotificationCounter');
            const notificationList = document.getElementById('notificationList');
            const clearAllNotifications = document.getElementById('clearAllNotifications');
            
            // ì•Œë¦¼ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            if (notificationButton) {
                notificationButton.addEventListener('click', () => {
                    notificationDropdown.classList.toggle('hidden');
                    
                    // ë“œë¡­ë‹¤ìš´ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                    document.addEventListener('click', function closeDropdown(e) {
                        if (!notificationDropdown.contains(e.target) && !notificationButton.contains(e.target)) {
                            notificationDropdown.classList.add('hidden');
                            document.removeEventListener('click', closeDropdown);
                        }
                    });
                });
            }
            
            // ëª¨ë‘ í™•ì¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            if (clearAllNotifications) {
                clearAllNotifications.addEventListener('click', () => {
                    notificationDropdown.classList.add('hidden');
                    // ì•Œë¦¼ í™•ì¸ ì²˜ë¦¬ (ì¶”í›„ ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ì‹œ í™œìš©)
                    // localStorage.setItem('lastNotificationCheck', new Date().toISOString());
                    
                    // ì•Œë¦¼ ì¹´ìš´í„° ì´ˆê¸°í™”
                    notificationCounter.textContent = '0';
                    dropdownNotificationCounter.textContent = '0';
                    
                    // ì•Œë¦¼ ëª©ë¡ ë¹„ìš°ê¸°
                    notificationList.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-6">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                });
            }
        }

        // ì•Œë¦¼ ë“œë¡­ë‹¤ìš´ ë‚´ìš© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateNotificationDropdown(lowStockItems) {
            const notificationList = document.getElementById('notificationList');
            const notificationCounter = document.getElementById('notificationCounter');
            const dropdownNotificationCounter = document.getElementById('dropdownNotificationCounter');
            
            if (!notificationList || !notificationCounter || !dropdownNotificationCounter) {
                console.error('ì•Œë¦¼ ê´€ë ¨ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // ì•Œë¦¼ ì¹´ìš´í„° ì—…ë°ì´íŠ¸
            const count = lowStockItems.length;
            notificationCounter.textContent = count;
            dropdownNotificationCounter.textContent = count;
            
            // ì•Œë¦¼ ëª©ë¡ ë¹„ìš°ê¸°
            notificationList.innerHTML = '';
            
            // ì•Œë¦¼ì´ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
            if (count === 0) {
                notificationList.innerHTML = '<div class="text-center text-gray-500 dark:text-gray-400 py-6">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            // ì•Œë¦¼ í•­ëª© ìƒì„±
            lowStockItems.forEach(item => {
                const currentStock = parseInt(item.currentStock || 0);
                const minStock = parseInt(item.minStock || 0);
                const diff = minStock - currentStock; // í•„ìš” ìˆ˜ëŸ‰
                
                const notificationItem = document.createElement('div');
                notificationItem.className = 'py-2 px-4 border-b border-gray-200 hover:bg-gray-50 dark:border-gray-700 dark:hover:bg-gray-700';
                
                notificationItem.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 rounded-full bg-red-200 dark:bg-red-900 p-1">
                            <i class="fas fa-exclamation-circle text-red-600 dark:text-red-400"></i>
                        </div>
                        <div class="ml-3 flex-1">
                            <p class="text-sm font-medium text-gray-900 dark:text-gray-200">${item.name} ì…ê³  í•„ìš”</p>
                            <p class="text-xs text-red-500 dark:text-red-400">í˜„ì¬ì¬ê³ : ${currentStock} / ìµœì†Œì¬ê³ : ${minStock}</p>
                            <p class="text-xs text-gray-500 dark:text-gray-400">${diff}ê°œ ë¶€ì¡±</p>
                        </div>
                    </div>
                `;
                
                notificationList.appendChild(notificationItem);
            });
        }

        // ì‹¤ì‹œê°„ ì•Œë¦¼ ì˜ì—­ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ìˆ˜ì •
        async function updateAlerts() {
            try {
                // ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const result = await window.partsAPI.getExcelData();
                if (!result.success) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', result.error);
                    return;
                }
                
                // ìƒíƒœê°€ 'í•„ìš”'ì¸ í•­ëª©ë§Œ í•„í„°ë§
                // í˜„ì¬ ì¬ê³ ê°€ ìµœì†Œ ì¬ê³ ë³´ë‹¤ ì ì€ ê²½ìš° 'í•„ìš”' ìƒíƒœë¡œ ê°„ì£¼
                const lowStockItems = result.data.filter(item => {
                    const currentStock = parseInt(item.currentStock || 0);
                    const minStock = parseInt(item.minStock || 0);
                    return currentStock < minStock;
                });
                
                // í•„ìš”í•œ ìˆ˜ëŸ‰ì´ ë§ì€ ìˆœìœ¼ë¡œ ì •ë ¬
                lowStockItems.sort((a, b) => {
                    const diffA = parseInt(a.minStock || 0) - parseInt(a.currentStock || 0);
                    const diffB = parseInt(b.minStock || 0) - parseInt(b.currentStock || 0);
                    return diffB - diffA; // ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
                });
                
                // ìµœëŒ€ 3ê°œ ì œí•œ ì œê±° - ëª¨ë“  í•­ëª© í‘œì‹œ
                const alertsToShow = lowStockItems;
                
                // ì•Œë¦¼ ì»¨í…Œì´ë„ˆ
                const alertsContainer = document.querySelector('.bg-orange-50.rounded-lg.shadow.p-6.dark\\:bg-orange-100 .space-y-4');
                if (!alertsContainer) {
                    console.error('ì•Œë¦¼ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ì»¨í…Œì´ë„ˆì— ê³ ì • ë†’ì´ì™€ ìŠ¤í¬ë¡¤ ì†ì„± ì¶”ê°€
                alertsContainer.classList.add('max-h-56', 'overflow-y-auto', 'pr-2');
                alertsContainer.style.scrollbarWidth = 'thin'; // Firefox
                alertsContainer.style.scrollbarColor = 'rgba(180, 180, 180, 0.5) transparent'; // Firefox
                
                // Webkit ë¸Œë¼ìš°ì €(Chrome, Safari ë“±)ìš© ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼
                const style = document.createElement('style');
                style.textContent = `
                    .space-y-4::-webkit-scrollbar {
                        width: 5px;
                    }
                    .space-y-4::-webkit-scrollbar-track {
                        background: transparent;
                    }
                    .space-y-4::-webkit-scrollbar-thumb {
                        background-color: rgba(180, 180, 180, 0.5);
                        border-radius: 20px;
                    }
                    .dark .space-y-4::-webkit-scrollbar-thumb {
                        background-color: rgba(100, 100, 100, 0.5);
                    }
                `;
                document.head.appendChild(style);
                
                // ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
                alertsContainer.innerHTML = '';
                
                // ì•Œë¦¼ ì—†ì„ ê²½ìš° ë©”ì‹œì§€ í‘œì‹œ
                if (alertsToShow.length === 0) {
                    const emptyMessage = document.createElement('div');
                    emptyMessage.className = 'text-center text-gray-500 dark:text-gray-400 py-4';
                    emptyMessage.textContent = 'ì¬ê³  ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.';
                    alertsContainer.appendChild(emptyMessage);
                } else {
                    // ê° ì•Œë¦¼ í•­ëª© ìƒì„±
                    alertsToShow.forEach(item => {
                        const alertDiv = document.createElement('div');
                        alertDiv.className = 'flex items-start mb-4'; // ë§ˆì§„ ì¶”ê°€
                        
                        // ì•„ì´ì½˜ ë¶€ë¶„
                        const iconDiv = document.createElement('div');
                        iconDiv.className = 'flex-shrink-0 w-8 h-8 rounded-full bg-red-200 dark:bg-red-900 flex items-center justify-center';
                        iconDiv.innerHTML = '<i class="fas fa-exclamation-circle text-red-600 dark:text-red-400"></i>';
                        
                        // ì»¨í…ì¸  ë¶€ë¶„
                        const contentDiv = document.createElement('div');
                        contentDiv.className = 'ml-3 flex-1'; // flex-1 ì¶”ê°€í•˜ì—¬ ë„ˆë¹„ í™•ë³´
                        
                        // í˜„ì¬ ì¬ê³ ì™€ ìµœì†Œ ì¬ê³  ê³„ì‚°
                        const currentStock = parseInt(item.currentStock || 0);
                        const minStock = parseInt(item.minStock || 0);
                        const diff = minStock - currentStock; // í•„ìš” ìˆ˜ëŸ‰
                        
                        // ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ ê²°ì • (í˜„ì¬ëŠ” ì…ê³ ì¼ë§Œ ì‚¬ìš©)
                        // ì¶”í›„ ì…ì¶œê³  ì´ë ¥ì´ ì¶”ê°€ë˜ë©´ ì‹¤ì œ ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ ë‚ ì§œë¡œ ë³€ê²½ ê°€ëŠ¥
                        const lastEventDate = item.inDate || 'ì •ë³´ ì—†ìŒ';
                        const eventType = 'ì…ê³ '; // í˜„ì¬ëŠ” ì…ê³ ì¼ë§Œ ìˆìœ¼ë¯€ë¡œ ê³ ì •ê°’
                        
                        // íƒ€ì´í‹€ ìƒì„± - í’ˆëª…ê³¼ í•„ìš” ìƒíƒœ
                        const title = document.createElement('p');
                        title.className = 'text-sm font-medium';
                        title.textContent = `${item.name} ì…ê³  í•„ìš”`;
                        
                        // ì„¤ëª… ìƒì„± - ìµœì†Œì¬ê³ ì™€ í˜„ì¬ì¬ê³ 
                        const description = document.createElement('p');
                        description.className = 'text-xs text-red-500 dark:text-red-400';
                        description.textContent = `ìµœì†Œì¬ê³ : ${minStock} / í˜„ì¬ì¬ê³ : ${currentStock} (${diff}ê°œ í•„ìš”)`;
                        
                        // ë‚ ì§œ ìƒì„± - ë§ˆì§€ë§‰ ì´ë²¤íŠ¸ ë‚ ì§œ
                        const date = document.createElement('p');
                        date.className = 'text-xs text-gray-500 dark:text-gray-400';
                        date.textContent = `ë§ˆì§€ë§‰ ${eventType}: ${lastEventDate}`;
                        
                        // ì»¨í…ì¸ ì— ìš”ì†Œ ì¶”ê°€
                        contentDiv.appendChild(title);
                        contentDiv.appendChild(description);
                        contentDiv.appendChild(date);
                        
                        // ëª¨ë“  ìš”ì†Œ ì¡°í•©
                        alertDiv.appendChild(iconDiv);
                        alertDiv.appendChild(contentDiv);
                        
                        // ì•Œë¦¼ ì¶”ê°€
                        alertsContainer.appendChild(alertDiv);
                    });
                }
                
                // ì•Œë¦¼ ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸
                updateNotificationDropdown(lowStockItems);
                
            } catch (error) {
                console.error('ì•Œë¦¼ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            }
        }

        // ë©”ì‹ ì € ê¸°ëŠ¥ ì´ˆê¸°í™”
        function setupMessenger() {
            const messengerButton = document.getElementById('messengerButton');
            const chatModal = document.getElementById('chatModal');
            const minimizeChatButton = document.getElementById('minimizeChatButton');
            const closeChatButton = document.getElementById('closeChatButton');
            const chatInput = document.getElementById('chatInput');
            const sendMessageButton = document.getElementById('sendMessageButton');
            const chatMessages = document.getElementById('chatMessages');
            const messageCounter = document.getElementById('messageCounter');
            
            // ì´ˆê¸° ë©”ì‹œì§€ ì¹´ìš´í„° ì„¤ì •
            messageCounter.textContent = "0";
            
            // ìƒˆ ë©”ì‹œì§€ ë„ì°© ì‹œë®¬ë ˆì´ì…˜ (ì£¼ê¸°ì ìœ¼ë¡œ ë©”ì‹œì§€ ì¹´ìš´í„° ì¦ê°€)
            let messageSimulationInterval;
            
            function startMessageSimulation() {
                // ì´ë¯¸ ì‹¤í–‰ ì¤‘ì¸ ê²½ìš° ì¤‘ì§€
                if (messageSimulationInterval) {
                    clearInterval(messageSimulationInterval);
                }
                
                // 15-30ì´ˆë§ˆë‹¤ ëœë¤í•˜ê²Œ ë©”ì‹œì§€ ì¹´ìš´í„° ì¦ê°€
                messageSimulationInterval = setInterval(() => {
                    if (chatModal.classList.contains('hidden')) {
                        const currentCount = parseInt(messageCounter.textContent);
                        messageCounter.textContent = currentCount + 1;
                    }
                }, Math.random() * 15000 + 15000);
            }
            
            // ë©”ì‹œì§€ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘
            startMessageSimulation();
            
            // ë©”ì‹ ì € ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            if (messengerButton) {
                messengerButton.addEventListener('click', () => {
                    chatModal.classList.remove('hidden');
                    // ë©”ì‹œì§€ ì¹´ìš´í„° ì´ˆê¸°í™”
                    messageCounter.textContent = "0";
                    
                    // ì±„íŒ…ì°½ ë‚´ìš© ìµœí•˜ë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                });
            }
            
            // ì±„íŒ…ì°½ ìµœì†Œí™” ë²„íŠ¼
            if (minimizeChatButton) {
                minimizeChatButton.addEventListener('click', () => {
                    chatModal.classList.add('hidden');
                });
            }
            
            // ì±„íŒ…ì°½ ë‹«ê¸° ë²„íŠ¼
            if (closeChatButton) {
                closeChatButton.addEventListener('click', () => {
                    chatModal.classList.add('hidden');
                });
            }
            
            // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜
            function sendMessage() {
                const messageText = chatInput.value.trim();
                if (messageText === '') return;
                
                // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
                const userMessageHTML = `
                    <div class="flex flex-col space-y-1">
                        <div class="flex items-end justify-end">
                            <div class="flex flex-col space-y-2 text-xs max-w-xs mx-2 order-1 items-end">
                                <div><span class="px-4 py-2 rounded-lg inline-block rounded-br-none bg-orange-500 text-white dark:bg-orange-600">${messageText}</span></div>
                            </div>
                            <img src="https://via.placeholder.com/30" alt="ì‚¬ìš©ì" class="w-6 h-6 rounded-full order-2">
                        </div>
                    </div>
                `;
                
                chatMessages.innerHTML += userMessageHTML;
                chatInput.value = '';
                
                // ì—‘ì…€ì— ë©”ì‹œì§€ ì €ì¥
                saveChatToExcel(messageText);
                
                // ì±„íŒ…ì°½ ë‚´ìš© ìµœí•˜ë‹¨ìœ¼ë¡œ ìŠ¤í¬ë¡¤
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // ê°„ë‹¨í•œ ì‘ë‹µ ë©”ì‹œì§€ - ë©”ì‹œì§€ê°€ ê¸°ë¡ë˜ì—ˆìŒì„ ì•Œë¦¼
                setTimeout(() => {
                    const responseHTML = `
                        <div class="flex flex-col space-y-1">
                            <div class="flex items-end">
                                <div class="flex flex-col space-y-2 text-xs max-w-xs mx-2 order-2 items-start">
                                    <div><span class="px-4 py-2 rounded-lg inline-block rounded-bl-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200">ë©”ì‹œì§€ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.</span></div>
                                </div>
                                <img src="https://via.placeholder.com/30" alt="ì‹œìŠ¤í…œ" class="w-6 h-6 rounded-full order-1">
                            </div>
                        </div>
                    `;
                    
                    chatMessages.innerHTML += responseHTML;
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 500);
            }
            
            // ì±„íŒ… ë‚´ìš©ì„ ì—‘ì…€ íŒŒì¼ì— ì €ì¥í•˜ëŠ” í•¨ìˆ˜
            async function saveChatToExcel(message) {
                try {
                    // í˜„ì¬ ë‚ ì§œì™€ ì‹œê°„ ìƒì„±
                    const now = new Date();
                    const dateTimeString = now.toLocaleString(); // í˜„ì§€ í˜•ì‹ì˜ ë‚ ì§œì™€ ì‹œê°„
                    
                    // IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° 
                    let ipAddress = "ì•Œ ìˆ˜ ì—†ìŒ";
                    try {
                        // IP ì£¼ì†Œ ê°€ì ¸ì˜¤ê¸° (Electron í™˜ê²½ì—ì„œ)
                        const ipResult = await window.partsAPI.getClientIP();
                        if (ipResult.success) {
                            ipAddress = ipResult.data;
                        }
                    } catch (error) {
                        console.warn('IP ì£¼ì†Œë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                    }
                    
                    console.log('ì—‘ì…€ì— ì €ì¥í•  ë©”ì‹œì§€ ë°ì´í„°:', {
                        message,
                        dateTime: dateTimeString,
                        ipAddress
                    });
                    
                    // ë©”ì‹œì§€, ë‚ ì§œ/ì‹œê°„, IP ì£¼ì†Œë¥¼ ì—‘ì…€ì— ì €ì¥
                    const result = await window.partsAPI.saveChatMessage({
                        message: message,
                        dateTime: dateTimeString,
                        ipAddress: ipAddress
                    });
                    
                    console.log('ì±„íŒ… ë©”ì‹œì§€ ì €ì¥ ê²°ê³¼:', result);
                    
                    if (!result.success) {
                        console.error('ì±„íŒ… ë©”ì‹œì§€ ì €ì¥ ì‹¤íŒ¨:', result.error);
                    }
                } catch (error) {
                    console.error('ì±„íŒ… ë©”ì‹œì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                }
            }
            
            // ë©”ì‹œì§€ ì „ì†¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            if (sendMessageButton) {
                sendMessageButton.addEventListener('click', sendMessage);
            }
            
            // ì—”í„°í‚¤ ì…ë ¥ ì´ë²¤íŠ¸
            if (chatInput) {
                chatInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        sendMessage();
                    }
                });
            }
        }        // Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì´ˆê¸°í™” ë° ì„¤ì •
        const integratedChart = echarts.init(document.getElementById('integratedChart'));

        // Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ë°ì´í„° ìƒì„± ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        async function updateBoardUsageChart(filteredData = null) {
            try {
                let historyData;
                
                if (filteredData) {
                    historyData = filteredData;
                } else {
                    // ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const result = await window.partsAPI.getHistoryData();
                    if (!result.success) {
                        console.error('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', result.error);
                        
                        // ì˜¤ë¥˜ ìƒíƒœ ì°¨íŠ¸ í‘œì‹œ
                        integratedChart.setOption({
                            title: {
                                text: 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
                                left: 'center',
                                textStyle: {
                                    fontSize: 16,
                                    color: '#ff4757'
                                }
                            },
                            series: []
                        });
                        return;
                    }
                    historyData = result.data || [];
                }
                
                // ë‚ ì§œ í•„í„° ì ìš©
                historyData = filterDataByDate(historyData, 'date');
                
                console.log('Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„ ì‹œì‘, ë‚ ì§œ í•„í„° ì ìš© í›„ ë°ì´í„°:', historyData);
                
                // ì¶œê³  ë°ì´í„°ë§Œ í•„í„°ë§ (Boardë³„ ì‚¬ìš©ëŸ‰ì´ë¯€ë¡œ ì¶œê³  ë°ì´í„° ì‚¬ìš©)
                const exportData = historyData.filter(item => 
                    item.type === 'ì¶œê³ ' && item.name && item.amount
                );
                
                console.log('ì¶œê³  ë°ì´í„°:', exportData);
                
                // í’ˆëª…ë³„ ì‚¬ìš©ëŸ‰ ì§‘ê³„
                const categorySummary = {};

                exportData.forEach(item => {
                    const categoryName = item.category || 'ê¸°íƒ€'; // ì¹´í…Œê³ ë¦¬ë¡œ ë³€ê²½
                    
                    // ë‹¤ì–‘í•œ í•„ë“œëª…ìœ¼ë¡œ ìˆ˜ëŸ‰ ì‹œë„
                    let quantity = 0;
                    const possibleFields = ['quantity', 'count', 'amount', 'stock', 'value'];

                    // ì—¬ëŸ¬ í•„ë“œëª… ì‹œë„
                    for (const field of possibleFields) {
                        if (item[field] !== undefined && item[field] !== null) {
                            const rawValue = item[field];
                            
                            // ìˆ«ì ë³€í™˜ ì‹œë„
                            if (!isNaN(Number(rawValue))) {
                                quantity = Number(rawValue);
                                console.log(`${field} í•„ë“œì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì°¾ìŒ`);
                                break;
                            } 
                            // ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œ ì‹œë„
                            else if (typeof rawValue === 'string') {
                                const matches = rawValue.match(/\d+/);
                                if (matches && matches.length > 0) {
                                    quantity = Number(matches[0]);
                                    console.log(`${field} í•„ë“œì˜ ë¬¸ìì—´ì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì¶”ì¶œ`);
                                    break;
                                }
                            }
                        }
                    }

                    // ìˆ˜ëŸ‰ì´ 0ì´ë©´ ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •
                    if (quantity === 0) {
                        quantity = 1;
                        console.log(`ì¹´í…Œê³ ë¦¬: ${categoryName}ì˜ ìˆ˜ëŸ‰ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’ 1 ì‚¬ìš©`);
                    }
                    
                    if (!categorySummary[categoryName]) {
                        categorySummary[categoryName] = 0;
                    }
                    
                    categorySummary[categoryName] += quantity;
                });
                
                // ì°¨íŠ¸ ë°ì´í„° ë³€í™˜ (ì‚¬ìš©ëŸ‰ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬)
                const sortedData = Object.entries(categorySummary)
                    .sort(([,a], [,b]) => b - a); // ëª¨ë“  í’ˆëª© í‘œì‹œ
                
                const partNames = sortedData.map(([name]) => name);
                const usageData = sortedData.map(([, usage]) => usage);
                
                console.log('ì°¨íŠ¸ ë°ì´í„° - í’ˆëª…:', partNames);
                console.log('ì°¨íŠ¸ ë°ì´í„° - ì‚¬ìš©ëŸ‰:', usageData);
                
                // ì°¨íŠ¸ ì œëª©ì— í•„í„° ì •ë³´ í¬í•¨
                let chartTitle = `ğŸ¤– Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„ (${partNames.length}ê°œ í’ˆëª©)`;
                if (globalDateFilter.startDate || globalDateFilter.endDate) {
                    const startStr = globalDateFilter.startDate ? globalDateFilter.startDate.toLocaleDateString() : 'ì‹œì‘';
                    const endStr = globalDateFilter.endDate ? globalDateFilter.endDate.toLocaleDateString() : 'ì¢…ë£Œ';
                    chartTitle += ` [${startStr} ~ ${endStr}]`;
                }
                
                // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
                if (partNames.length === 0) {
                    integratedChart.setOption({
                        title: {
                            text: 'ì„ íƒ ê¸°ê°„ì— ì¶œê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤',
                            left: 'center',
                            textStyle: {
                                fontSize: 16,
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        },
                        series: []
                    });
                    return;
                }
                
                // 3D AI ë¯¸ë˜ì§€í–¥ì  ì°¨íŠ¸ ì˜µì…˜ ì„¤ì •
                integratedChart.setOption({
                    animation: true,
                    animationDuration: 2000,
                    animationEasing: 'cubicOut',
                    animationDelay: function (idx) {
                        return idx * 150;
                    },
                    backgroundColor: document.documentElement.classList.contains('dark') ? 
                        'transparent' : 'transparent',
                    title: {
                        text: chartTitle,
                        left: 'center',
                        top: '3%',
                        textStyle: {
                            fontSize: 18,
                            fontWeight: 'bold',
                            color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                            textShadowBlur: 10,
                            textShadowColor: document.documentElement.classList.contains('dark') ? 
                                'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                            shadowStyle: {
                                color: 'rgba(0, 212, 255, 0.2)',
                                shadowBlur: 20,
                                shadowOffsetX: 5,
                                shadowOffsetY: 5
                            }
                        },
                        formatter: function(params) {
                            const data = params[0];
                            return `
                                <div style="
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    border: none;
                                    border-radius: 12px;
                                    padding: 12px;
                                    color: white;
                                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                                    backdrop-filter: blur(10px);
                                ">
                                    <div style="font-weight: bold; margin-bottom: 8px;">
                                        ğŸ¯ ${data.name}
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <span style="margin-right: 8px;">ğŸ“Š</span>
                                        ì‚¬ìš©ëŸ‰: ${data.value}ê°œ
                                    </div>
                                </div>
                            `;
                        },
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        textStyle: {
                            color: '#ffffff'
                        }
                    },
                    grid: {
                        left: '8%',
                        right: '8%',
                        bottom: '15%',
                        top: '20%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: partNames,
                        axisPointer: {
                            type: 'shadow'
                        },
                        axisLabel: {
                            rotate: 45,
                            interval: 0,
                            textStyle: {
                                fontSize: 11,
                                fontWeight: 'bold',
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                textShadowBlur: 3,
                                textShadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2,
                                shadowBlur: 10,
                                shadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                            }
                        },
                        axisTick: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2
                            }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        name: 'ğŸ¤– ì‚¬ìš©ëŸ‰ ë¶„ì„ (ê°œ)',
                        nameTextStyle: {
                            color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                            fontSize: 13,
                            fontWeight: 'bold',
                            textShadowBlur: 5,
                            textShadowColor: document.documentElement.classList.contains('dark') ? 
                                'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                        },
                        axisLabel: {
                            formatter: '{value}',
                            textStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                fontSize: 11,
                                fontWeight: 'bold',
                                textShadowBlur: 3,
                                textShadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2,
                                shadowBlur: 10,
                                shadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.1)' : 'rgba(0, 102, 204, 0.1)',
                                width: 1,
                                type: 'dashed'
                            }
                        }
                    },
                    series: [
                        {
                            name: 'ğŸ¤– ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„',
                            type: 'bar',
                            data: usageData.map((value, index) => ({
                                value: value,
                                itemStyle: {
                                    // 3D ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ë°°ì—´
                                    color: function() {
                                        const futuristicColors = [
                                            // ë„¤ì˜¨ ì‚¬ì´ë²„ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ff006e'},
                                                    {offset: 0.5, color: '#8338ec'},
                                                    {offset: 1, color: '#3a86ff'}
                                                ]
                                            },
                                            // í™€ë¡œê·¸ë¨ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#00f5ff'},
                                                    {offset: 0.5, color: '#00d4ff'},
                                                    {offset: 1, color: '#0066cc'}
                                                ]
                                            },
                                            // AI ê·¸ë¦° ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#39ff14'},
                                                    {offset: 0.5, color: '#00ff88'},
                                                    {offset: 1, color: '#00cc66'}
                                                ]
                                            },
                                            // í“¨ì²˜ ì˜¤ë Œì§€ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ff9500'},
                                                    {offset: 0.5, color: '#ff6b35'},
                                                    {offset: 1, color: '#e65100'}
                                                ]
                                            },
                                            // ë„¤ì˜¨ í¼í”Œ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#d946ef'},
                                                    {offset: 0.5, color: '#a855f7'},
                                                    {offset: 1, color: '#7c3aed'}
                                                ]
                                            },
                                            // ì‚¬ì´ë²„ ì˜ë¡œìš° ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ffd60a'},
                                                    {offset: 0.5, color: '#ffbe0b'},
                                                    {offset: 1, color: '#fb8500'}
                                                ]
                                            }
                                        ];
                                        return futuristicColors[index % futuristicColors.length];
                                    }(),
                                    borderRadius: [8, 8, 0, 0],
                                    // 3D íš¨ê³¼ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ê·¸ë¦¼ì
                                    shadowBlur: 25,
                                    shadowColor: 'rgba(0, 212, 255, 0.6)',
                                    shadowOffsetX: 8,
                                    shadowOffsetY: 12,
                                    // ë„¤ì˜¨ ë°œê´‘ íš¨ê³¼
                                    borderColor: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                    borderWidth: 2,
                                    // 3D ê¹Šì´ê°ì„ ìœ„í•œ opacity ë³€í™”
                                    opacity: 0.9
                                }
                            })),
                            emphasis: {
                                focus: 'series',
                                itemStyle: {
                                    shadowBlur: 40,
                                    shadowOffsetX: 12,
                                    shadowOffsetY: 18,
                                    shadowColor: 'rgba(0, 212, 255, 0.8)',
                                    borderWidth: 3,
                                    borderColor: '#ffffff',
                                    opacity: 1,
                                    // í˜¸ë²„ ì‹œ ìŠ¤ì¼€ì¼ ì—… íš¨ê³¼
                                    scale: 1.05
                                },
                                // 3D ë³€í˜• íš¨ê³¼
                                scaleSize: 8
                            },
                            barMaxWidth: 60,
                            // ë§‰ëŒ€ ê°„ê²© ì¡°ì •ìœ¼ë¡œ 3D íš¨ê³¼ ê°•í™”
                            barGap: '20%',
                            // ë§‰ëŒ€ ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ ì²˜ë¦¬
                            barBorderRadius: [8, 8, 0, 0],
                            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
                            animationDuration: 2000,
                            animationEasing: 'elasticOut',
                            animationDelay: function (idx) {
                                return idx * 200;
                            },
                            // 3D ë¼ë²¨ íš¨ê³¼
                            label: {
                                show: true,
                                position: 'top',
                                formatter: 'ğŸš€ {c}',
                                textStyle: {
                                    color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                    fontSize: 12,
                                    fontWeight: 'bold',
                                    textShadowBlur: 8,
                                    textShadowColor: document.documentElement.classList.contains('dark') ? 
                                        'rgba(0, 212, 255, 0.8)' : 'rgba(0, 102, 204, 0.6)',
                                    textShadowOffsetX: 2,
                                    textShadowOffsetY: 2
                                }
                            },
                            // 3D ë°œê´‘ íš¨ê³¼ë¥¼ ìœ„í•œ markLine ì¶”ê°€
                            markLine: {
                                silent: true,
                                lineStyle: {
                                    color: document.documentElement.classList.contains('dark') ? 
                                        'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                                    width: 1,
                                    type: 'dashed'
                                },
                                data: [
                                    {type: 'average', name: 'AI í‰ê· ê°’'}
                                ]
                            }
                        }
                    ],
                    // 3D íš¨ê³¼ë¥¼ ìœ„í•œ ì¶”ê°€ ì˜µì…˜
                    graphic: [
                        {
                            type: 'group',
                            left: 'center',
                            top: '5%',
                            children: [
                                {
                                    type: 'rect',
                                    z: 100,
                                    left: 'center',
                                    top: 'middle',
                                    shape: {
                                        width: 0,
                                        height: 0
                                    },
                                    style: {
                                        fill: 'transparent'
                                    }
                                }
                            ]
                        }
                    ]
                });
                
                console.log('3D AI Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                console.error('Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                
                // ì˜¤ë¥˜ ì°¨íŠ¸ í‘œì‹œ
                integratedChart.setOption({
                    title: {
                        text: 'ğŸ¤– AI ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            color: '#ff4757'
                        }
                    },
                    series: []
                });
            }
        }

        // ë‚ ì§œ ë²”ìœ„ í•„í„°ì™€ ê´€ë ¨ëœ ì „ì—­ ë³€ìˆ˜
        let globalDateFilter = {
            startDate: null,
            endDate: null
        };

        // ë‚ ì§œ ë²”ìœ„ í•„í„° ì´ˆê¸°í™”
        function setupDateFilter() {
            const startDateFilter = document.getElementById('startDateFilter');
            const endDateFilter = document.getElementById('endDateFilter');
            const applyDateFilter = document.getElementById('applyDateFilter');
            const resetDateFilter = document.getElementById('resetDateFilter');

            // í˜„ì¬ ë‚ ì§œë¡œ ê¸°ë³¸ê°’ ì„¤ì • (ìµœê·¼ 1ê°œì›”)
            const today = new Date();
            const oneMonthAgo = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            
            endDateFilter.value = today.toISOString().split('T')[0];
            startDateFilter.value = oneMonthAgo.toISOString().split('T')[0];

            // ì´ˆê¸° í•„í„° ê°’ ì„¤ì •
            globalDateFilter.startDate = oneMonthAgo;
            globalDateFilter.endDate = today;

            // í•„í„° ì ìš© ë²„íŠ¼ ì´ë²¤íŠ¸
            if (applyDateFilter) {
                applyDateFilter.addEventListener('click', async () => {
                    const startDate = startDateFilter.value ? new Date(startDateFilter.value) : null;
                    const endDate = endDateFilter.value ? new Date(endDateFilter.value) : null;

                    // ë‚ ì§œ ìœ íš¨ì„± ê²€ì‚¬
                    if (startDate && endDate && startDate > endDate) {
                        alert('ì‹œì‘ ë‚ ì§œëŠ” ì¢…ë£Œ ë‚ ì§œë³´ë‹¤ ì´ì „ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
                        return;
                    }

                    // ì „ì—­ í•„í„° ê°’ ì—…ë°ì´íŠ¸
                    globalDateFilter.startDate = startDate;
                    globalDateFilter.endDate = endDate;

                    console.log('ë‚ ì§œ í•„í„° ì ìš©:', globalDateFilter);

                    // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                    await updateAllChartsWithDateFilter();
                });
            }

            // í•„í„° ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
            if (resetDateFilter) {
                resetDateFilter.addEventListener('click', async () => {
                    startDateFilter.value = '';
                    endDateFilter.value = '';
                    globalDateFilter.startDate = null;
                    globalDateFilter.endDate = null;

                    console.log('ë‚ ì§œ í•„í„° ì´ˆê¸°í™”');

                    // ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (í•„í„° ì—†ì´)
                    await updateAllChartsWithDateFilter();
                });
            }
        }

        // ë‚ ì§œ í•„í„°ë§ í•¨ìˆ˜
        function filterDataByDate(data, dateField = 'date') {
            if (!globalDateFilter.startDate && !globalDateFilter.endDate) {
                return data; // í•„í„°ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ì „ì²´ ë°ì´í„° ë°˜í™˜
            }

            return data.filter(item => {
                if (!item[dateField]) return true; // ë‚ ì§œ ì •ë³´ê°€ ì—†ìœ¼ë©´ í¬í•¨

                try {
                    const itemDate = new Date(item[dateField]);
                    if (isNaN(itemDate.getTime())) return true; // ìœ íš¨í•˜ì§€ ì•Šì€ ë‚ ì§œë©´ í¬í•¨

                    // ì‹œì‘ ë‚ ì§œ ì²´í¬
                    if (globalDateFilter.startDate && itemDate < globalDateFilter.startDate) {
                        return false;
                    }

                    // ì¢…ë£Œ ë‚ ì§œ ì²´í¬ (ì¢…ë£Œ ë‚ ì§œ ë‹¹ì¼ 23:59:59ê¹Œì§€ í¬í•¨)
                    if (globalDateFilter.endDate) {
                        const endOfDay = new Date(globalDateFilter.endDate);
                        endOfDay.setHours(23, 59, 59, 999);
                        if (itemDate > endOfDay) {
                            return false;
                        }
                    }

                    return true;
                } catch (error) {
                    console.warn('ë‚ ì§œ í•„í„°ë§ ì¤‘ ì˜¤ë¥˜:', error, item);
                    return true; // ì˜¤ë¥˜ ë°œìƒ ì‹œ í¬í•¨
                }
            });
        }

        // ëª¨ë“  ì°¨íŠ¸ë¥¼ ë‚ ì§œ í•„í„°ì™€ í•¨ê»˜ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        async function updateAllChartsWithDateFilter() {
            try {
                console.log('ë‚ ì§œ í•„í„°ë¥¼ ì ìš©í•˜ì—¬ ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì‹œì‘');
                
                // ë¡œë”© í‘œì‹œ (ì„ íƒì‚¬í•­)
                const loadingMessage = document.createElement('div');
                loadingMessage.id = 'chartLoadingMessage';
                loadingMessage.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-orange-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                loadingMessage.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘...';
                document.body.appendChild(loadingMessage);

                // 1. ì¬ê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                await updateStockChart();
                
                // 2. ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸  
                await updateFlowChart();
                
                // 3. Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
                await updateBoardUsageChart();
                
                // 4. ì‹¤ì‹œê°„ ì•Œë¦¼ ì—…ë°ì´íŠ¸
                await updateAlerts();

                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loading = document.getElementById('chartLoadingMessage');
                if (loading) {
                    loading.remove();
                }

                console.log('ëª¨ë“  ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ (3ì´ˆ í›„ ìë™ ì œê±°)
                const successMessage = document.createElement('div');
                successMessage.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                successMessage.innerHTML = '<i class="fas fa-check mr-2"></i>ì°¨íŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.';
                document.body.appendChild(successMessage);
                
                setTimeout(() => {
                    if (successMessage.parentNode) {
                        successMessage.remove();
                    }
                }, 3000);

            } catch (error) {
                console.error('ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                
                // ë¡œë”© ë©”ì‹œì§€ ì œê±°
                const loading = document.getElementById('chartLoadingMessage');
                if (loading) {
                    loading.remove();
                }
                
                // ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ
                const errorMessage = document.createElement('div');
                errorMessage.className = 'fixed top-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                errorMessage.innerHTML = '<i class="fas fa-exclamation-triangle mr-2"></i>ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                document.body.appendChild(errorMessage);
                
                setTimeout(() => {
                    if (errorMessage.parentNode) {
                        errorMessage.remove();
                    }
                }, 5000);
            }
        }

        // ì¬ê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë‚ ì§œ í•„í„° ì ìš©)
        async function updateStockChart() {
            try {
                const stockChart = echarts.init(document.getElementById('stockChart'));
                
                // 1. ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const result = await window.partsAPI.getHistoryData();
                if (!result.success) {
                    console.error('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', result.error);
                    stockChart.setOption({
                        series: [{
                            data: [
                                { value: 1, name: 'ë°ì´í„° ì—†ìŒ' }
                            ]
                        }]
                    });
                    return;
                }
                
                console.log('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„°:', result.data);
                
                // ë‚ ì§œ í•„í„° ì ìš©
                let filteredData = filterDataByDate(result.data || [], 'date');
                
                console.log('ë‚ ì§œ í•„í„° ì ìš© í›„ ë°ì´í„°:', filteredData);
                
                // 2. ì¶œê³  ë°ì´í„°ë§Œ í•„í„°ë§ (íƒ€ì… í•„ë“œ ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´ í™•ì¸)
                const outflowData = filteredData.filter(item => {
                    // ì¶œê³  ë°ì´í„°ë§Œ í•„í„°ë§ (ëŒ€ì†Œë¬¸ì êµ¬ë¶„ ì—†ì´)
                    const type = (item.type || '').toLowerCase();
                    return type === 'ì¶œê³ ' || type === 'out' || type === 'outflow';
                });
                
                console.log('í•„í„°ë§ëœ ì¶œê³  ë°ì´í„°:', outflowData);
                
                // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
                if (outflowData.length === 0) {
                    console.log('ì‹¤ì œ ì¶œê³  ë°ì´í„°ê°€ ì—†ì–´ í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                    // í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€
                    outflowData.push(
                        { name: 'PCB', quantity: 45, type: 'ì¶œê³ ' },
                        { name: 'IC', quantity: 25, type: 'ì¶œê³ ' },
                        { name: 'ì €í•­', quantity: 15, type: 'ì¶œê³ ' },
                        { name: 'ê¸°íƒ€', quantity: 15, type: 'ì¶œê³ ' }
                    );
                }

                // 3. í’ˆëª…ë³„ë¡œ ì¶œê³  ìˆ˜ëŸ‰ í•©ê³„ ê³„ì‚°
                const categorySummary = {};

                outflowData.forEach(item => {
                    const categoryName = item.category || 'ê¸°íƒ€'; // ì¹´í…Œê³ ë¦¬ë¡œ ë³€ê²½
                    
                    // ë‹¤ì–‘í•œ í•„ë“œëª…ìœ¼ë¡œ ìˆ˜ëŸ‰ ì‹œë„
                    let quantity = 0;
                    const possibleFields = ['quantity', 'count', 'amount', 'stock', 'value'];

                    // ì—¬ëŸ¬ í•„ë“œëª… ì‹œë„
                    for (const field of possibleFields) {
                        if (item[field] !== undefined && item[field] !== null) {
                            const rawValue = item[field];
                            
                            // ìˆ«ì ë³€í™˜ ì‹œë„
                            if (!isNaN(Number(rawValue))) {
                                quantity = Number(rawValue);
                                console.log(`${field} í•„ë“œì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì°¾ìŒ`);
                                break;
                            } 
                            // ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œ ì‹œë„
                            else if (typeof rawValue === 'string') {
                                const matches = rawValue.match(/\d+/);
                                if (matches && matches.length > 0) {
                                    quantity = Number(matches[0]);
                                    console.log(`${field} í•„ë“œì˜ ë¬¸ìì—´ì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì¶”ì¶œ`);
                                    break;
                                }
                            }
                        }
                    }

                    // ìˆ˜ëŸ‰ì´ 0ì´ë©´ ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •
                    if (quantity === 0) {
                        quantity = 1;
                        console.log(`ì¹´í…Œê³ ë¦¬: ${categoryName}ì˜ ìˆ˜ëŸ‰ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’ 1 ì‚¬ìš©`);
                    }
                    
                    if (!categorySummary[categoryName]) {
                        categorySummary[categoryName] = 0;
                    }
                    
                    categorySummary[categoryName] += quantity;
                });
                
                // 4. ì°¨íŠ¸ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ë³€í™˜
                const chartData = Object.keys(categorySummary).map(name => {
                    return {
                        name: name,
                        value: categorySummary[name]
                    };
                });
                
                // 5. ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
                if (chartData.length === 0) {
                    chartData.push({
                        name: 'ì„ íƒ ê¸°ê°„ ì¶œê³  ë°ì´í„° ì—†ìŒ',
                        value: 1
                    });
                }
                
                console.log('ìµœì¢… ì°¨íŠ¸ ë°ì´í„°:', chartData);
                
                // 6. ì°¨íŠ¸ ì œëª©ì— í•„í„° ì •ë³´ í¬í•¨
                let chartTitle = 'ì¹´í…Œê³ ë¦¬ë³„ ì¶œê³  í˜„í™©';
                if (globalDateFilter.startDate || globalDateFilter.endDate) {
                    const startStr = globalDateFilter.startDate ? globalDateFilter.startDate.toLocaleDateString() : 'ì‹œì‘';
                    const endStr = globalDateFilter.endDate ? globalDateFilter.endDate.toLocaleDateString() : 'ì¢…ë£Œ';
                    chartTitle += ` (${startStr} ~ ${endStr})`;
                }
                
                // ê°€ë¡œ ë§‰ëŒ€ ì°¨íŠ¸ ì„¤ì •
                // í¼ì„¼í…Œì´ì§€ ê³„ì‚°ì„ ìœ„í•œ ì´í•© êµ¬í•˜ê¸°
                const totalValue = chartData.reduce((sum, item) => sum + item.value, 0);
                
                // í¼ì„¼í…Œì´ì§€ê°€ í° ìˆœì„œëŒ€ë¡œ ì •ë ¬
                const sortedData = chartData.sort((a, b) => b.value - a.value);
                
                // Yì¶• ì¹´í…Œê³ ë¦¬ ì´ë¦„ê³¼ Xì¶• í¼ì„¼í…Œì´ì§€ ë°ì´í„° ë¶„ë¦¬
                const categories = sortedData.map(item => item.name);
                const percentages = sortedData.map(item => 
                    totalValue > 0 ? ((item.value / totalValue) * 100).toFixed(1) : 0
                );
                const values = sortedData.map(item => item.value);
                
                stockChart.setOption({
                    animation: true,
                    animationDuration: 1500,
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 200;
                    },
                    title: {
                        text: chartTitle,
                        left: 'center',
                        textStyle: {
                            fontSize: 14,
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow'
                        },
                        formatter: function(params) {
                            const data = params[0];
                            const index = data.dataIndex;
                            const value = values[index];
                            const percentage = percentages[index];
                            return `${data.name}<br/>ì¶œê³ ëŸ‰: ${value}ê°œ<br/>ë¹„ìœ¨: ${percentage}%`;
                        },
                        backgroundColor: document.documentElement.classList.contains('dark') ? 'rgba(30, 30, 30, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                        borderColor: document.documentElement.classList.contains('dark') ? '#333' : '#ccc',
                        textStyle: {
                            color: document.documentElement.classList.contains('dark') ? '#fff' : '#333'
                        }
                    },
                    grid: {
                        left: '15%',
                        right: '10%',
                        top: '15%',
                        bottom: '10%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'value',
                        max: 100,
                        axisLabel: {
                            formatter: '{value}',
                            textStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        }
                    },
                    yAxis: {
                        type: 'category',
                        data: categories,
                        axisLabel: {
                            textStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        }
                    },
                    series: [{
                        name: 'ì¶œê³  ë¹„ìœ¨',
                        type: 'bar',
                        data: percentages.map((percentage, index) => ({
                            value: percentage,
                            itemStyle: {
                                color: function() {
                                    const colors = [
                                        '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', 
                                        '#FECA57', '#A29BFE', '#FD79A8', '#E17055'
                                    ];
                                    return colors[index % colors.length];
                                }
                            }
                        })),
                        label: {
                            show: true,
                            position: 'right',
                            formatter: function(params) {
                                return 'ğŸƒâ€â™‚ï¸ ' + params.value + '%';
                            },
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333',
                            fontSize: 12,
                            fontWeight: 'bold'
                        },
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 20,
                                shadowOffsetX: 3,
                                shadowOffsetY: 3,
                                shadowColor: 'rgba(0, 0, 0, 0.4)'
                            }
                        },
                        barMaxWidth: 30
                    }]
                });
                
                console.log('ì¹´í…Œê³ ë¦¬ë³„ ì¶œê³  í˜„í™© ì°¨íŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.', chartData);
                
            } catch (error) {
                console.error('ì¬ê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                const stockChart = echarts.init(document.getElementById('stockChart'));
                stockChart.setOption({
                    series: [{
                        data: [
                            { value: 1, name: 'ì˜¤ë¥˜ ë°œìƒ' }
                        ]
                    }]
                });
            }
        }

        // ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë‚ ì§œ í•„í„° ì ìš©)
        async function updateFlowChart() {
            try {
                const flowChart = echarts.init(document.getElementById('flowChart'));
                
                // 1. ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const result = await window.partsAPI.getHistoryData();
                if (!result.success) {
                    console.error('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', result.error);
                    flowChart.setOption({
                        animation: false,
                        title: {
                            text: 'êµ¬ë§¤ê¸ˆì•¡ í•©ê³„',
                            left: 'center',
                            textStyle: {
                                fontSize: 14,
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        },
                        series: [{
                            type: 'pie',
                            radius: ['30%', '60%'],
                            center: ['50%', '45%'],
                            data: [{ value: 0, name: 'ë°ì´í„° ì—†ìŒ' }]
                        }]
                    });
                    return;
                }
                
                console.log('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„°:', result.data);
                
                // ë‚ ì§œ í•„í„° ì ìš©
                let filteredData = filterDataByDate(result.data || [], 'date');
                
                // 2. ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë§¤ê¸ˆì•¡ ì§‘ê³„
                const categoryAmounts = {};
                
                if (filteredData && filteredData.length > 0) {
                    filteredData.forEach(item => {
                        if (item.category && item.purchasePrice && !isNaN(item.purchasePrice)) {
                            const category = item.category;
                            const amount = parseFloat(item.purchasePrice) || 0;
                            
                            if (categoryAmounts[category]) {
                                categoryAmounts[category] += amount;
                            } else {
                                categoryAmounts[category] = amount;
                            }
                        }
                    });
                }
                
                // 3. ì°¨íŠ¸ ë°ì´í„° ë³€í™˜
                const chartData = Object.entries(categoryAmounts).map(([category, amount]) => ({
                    name: category,
                    value: amount
                }));
                
                // 4. ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
                if (chartData.length === 0) {
                    chartData.push({ value: 0, name: 'ì„ íƒ ê¸°ê°„ êµ¬ë§¤ ë‚´ì—­ ì—†ìŒ' });
                }
                
                console.log('ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë§¤ê¸ˆì•¡ ì°¨íŠ¸ ë°ì´í„°:', chartData);
                
                // 5. ì°¨íŠ¸ ì œëª©ì— í•„í„° ì •ë³´ í¬í•¨
                let chartTitle = 'ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë§¤ê¸ˆì•¡';
                if (globalDateFilter.startDate || globalDateFilter.endDate) {
                    const startStr = globalDateFilter.startDate ? globalDateFilter.startDate.toLocaleDateString() : 'ì‹œì‘';
                    const endStr = globalDateFilter.endDate ? globalDateFilter.endDate.toLocaleDateString() : 'ì¢…ë£Œ';
                    chartTitle += ` (${startStr} ~ ${endStr})`;
                }
                
                // ì›í˜• ì°¨íŠ¸ ì˜µì…˜ ì„¤ì •
                flowChart.setOption({
                    animation: true,
                    animationDuration: 1500,
                    animationEasing: 'elasticOut',
                    animationDelay: function (idx) {
                        return idx * 200;
                    },
                    title: {
                        text: chartTitle,
                        left: 'center',
                        top: 10,
                        textStyle: {
                            fontSize: 14,
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                        }
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: function(params) {
                            if (params.value === 0) {
                                return params.name;
                            }
                            return `${params.name}<br/>êµ¬ë§¤ê¸ˆì•¡: â‚©${params.value.toLocaleString()}<br/>ë¹„ìœ¨: ${params.percent}%`;
                        },
                        backgroundColor: document.documentElement.classList.contains('dark') ? 'rgba(30, 30, 30, 0.9)' : 'rgba(255, 255, 255, 0.9)',
                        textStyle: {
                            color: document.documentElement.classList.contains('dark') ? '#fff' : '#333'
                        }
                    },
                    legend: {
                        orient: 'horizontal',
                        bottom: 10,
                        textStyle: {
                            fontSize: 12,
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                        }
                    },
                    series: [{
                        type: 'pie',
                        radius: ['30%', '60%'],
                        center: ['50%', '45%'],
                        data: chartData,
                        itemStyle: {
                            borderRadius: 15,
                            borderColor: document.documentElement.classList.contains('dark') ? '#2d2d2d' : '#fff',
                            borderWidth: 3,
                            // 3D íš¨ê³¼ë¥¼ ìœ„í•œ ê·¸ë¦¼ì ì¶”ê°€
                            shadowBlur: 15,
                            shadowColor: 'rgba(0, 0, 0, 0.3)',
                            shadowOffsetX: 3,
                            shadowOffsetY: 8,
                            // ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ë¡œ 3D ëŠë‚Œ ì—°ì¶œ
                            color: function(params) {
                                const colors = [
                                    ['#FF9500', '#FF6B35'],
                                    ['#2ECC71', '#27AE60'],
                                    ['#3498DB', '#2980B9'],
                                    ['#9B59B6', '#8E44AD'],
                                    ['#E74C3C', '#C0392B'],
                                    ['#F39C12', '#E67E22'],
                                    ['#1ABC9C', '#16A085'],
                                    ['#34495E', '#2C3E50']
                                ];
                                const colorPair = colors[params.dataIndex % colors.length];
                                return {
                                    type: 'linear',
                                    x: 0, y: 0, x2: 1, y2: 1,
                                    colorStops: [{
                                        offset: 0, color: colorPair[0]
                                    }, {
                                        offset: 1, color: colorPair[1]
                                    }]
                                };
                            }
                        },
                        emphasis: {
                            itemStyle: {
                                shadowBlur: 25,
                                shadowOffsetX: 5,
                                shadowOffsetY: 12,
                                shadowColor: 'rgba(0, 0, 0, 0.4)',
                                scale: true,
                                scaleSize: 10
                            },
                            scale: true,
                            scaleSize: 5
                        },
                        label: {
                            show: true,
                            formatter: function(params) {
                                if (params.value === 0) {
                                    return params.name;
                                }
                                return `${params.name}\nâ‚©${params.value.toLocaleString()}`;
                            },
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333',
                            fontSize: 12,
                            fontWeight: 'bold',
                            textShadowBlur: 3,
                            textShadowColor: 'rgba(0, 0, 0, 0.3)',
                            textShadowOffsetX: 1,
                            textShadowOffsetY: 1
                        }
                    }]
                });
                
                console.log('ì¹´í…Œê³ ë¦¬ë³„ êµ¬ë§¤ê¸ˆì•¡ ì°¨íŠ¸ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                console.error('ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                const flowChart = echarts.init(document.getElementById('flowChart'));
                flowChart.setOption({
                    title: {
                        text: 'ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
                        left: 'center',
                        textStyle: {
                            fontSize: 14,
                            color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                        }
                    },
                    series: []
                });
            }
        }

        // Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ë°ì´í„° ìƒì„± ë° ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë‚ ì§œ í•„í„° ì ìš©)
        async function updateBoardUsageChart(filteredData = null) {
            try {
                let historyData;
                
                if (filteredData) {
                    historyData = filteredData;
                } else {
                    // ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                    const result = await window.partsAPI.getHistoryData();
                    if (!result.success) {
                        console.error('ì…ì¶œê³  ë‚´ì—­ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', result.error);
                        
                        // ì˜¤ë¥˜ ìƒíƒœ ì°¨íŠ¸ í‘œì‹œ
                        integratedChart.setOption({
                            title: {
                                text: 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤',
                                left: 'center',
                                textStyle: {
                                    fontSize: 16,
                                    color: '#ff4757'
                                }
                            },
                            series: []
                        });
                        return;
                    }
                    historyData = result.data || [];
                }
                
                // ë‚ ì§œ í•„í„° ì ìš©
                historyData = filterDataByDate(historyData, 'date');
                
                console.log('Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„ ì‹œì‘, ë‚ ì§œ í•„í„° ì ìš© í›„ ë°ì´í„°:', historyData);
                
                // ì¶œê³  ë°ì´í„°ë§Œ í•„í„°ë§ (Boardë³„ ì‚¬ìš©ëŸ‰ì´ë¯€ë¡œ ì¶œê³  ë°ì´í„° ì‚¬ìš©)
                const exportData = historyData.filter(item => 
                    item.type === 'ì¶œê³ ' && item.name && item.amount
                );
                
                console.log('ì¶œê³  ë°ì´í„°:', exportData);
                
                // í’ˆëª…ë³„ ì‚¬ìš©ëŸ‰ ì§‘ê³„
                const categorySummary = {};

                exportData.forEach(item => {
                    const categoryName = item.category || 'ê¸°íƒ€'; // ì¹´í…Œê³ ë¦¬ë¡œ ë³€ê²½
                    
                    // ë‹¤ì–‘í•œ í•„ë“œëª…ìœ¼ë¡œ ìˆ˜ëŸ‰ ì‹œë„
                    let quantity = 0;
                    const possibleFields = ['quantity', 'count', 'amount', 'stock', 'value'];

                    // ì—¬ëŸ¬ í•„ë“œëª… ì‹œë„
                    for (const field of possibleFields) {
                        if (item[field] !== undefined && item[field] !== null) {
                            const rawValue = item[field];
                            
                            // ìˆ«ì ë³€í™˜ ì‹œë„
                            if (!isNaN(Number(rawValue))) {
                                quantity = Number(rawValue);
                                console.log(`${field} í•„ë“œì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì°¾ìŒ`);
                                break;
                            } 
                            // ë¬¸ìì—´ì—ì„œ ìˆ«ì ì¶”ì¶œ ì‹œë„
                            else if (typeof rawValue === 'string') {
                                const matches = rawValue.match(/\d+/);
                                if (matches && matches.length > 0) {
                                    quantity = Number(matches[0]);
                                    console.log(`${field} í•„ë“œì˜ ë¬¸ìì—´ì—ì„œ ìˆ˜ëŸ‰ ${quantity} ì¶”ì¶œ`);
                                    break;
                                }
                            }
                        }
                    }

                    // ìˆ˜ëŸ‰ì´ 0ì´ë©´ ê¸°ë³¸ê°’ 1ë¡œ ì„¤ì •
                    if (quantity === 0) {
                        quantity = 1;
                        console.log(`ì¹´í…Œê³ ë¦¬: ${categoryName}ì˜ ìˆ˜ëŸ‰ì„ ì°¾ì„ ìˆ˜ ì—†ì–´ ê¸°ë³¸ê°’ 1 ì‚¬ìš©`);
                    }
                    
                    if (!categorySummary[categoryName]) {
                        categorySummary[categoryName] = 0;
                    }
                    
                    categorySummary[categoryName] += quantity;
                });
                
                // ì°¨íŠ¸ ë°ì´í„° ë³€í™˜ (ì‚¬ìš©ëŸ‰ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬)
                const sortedData = Object.entries(categorySummary)
                    .sort(([,a], [,b]) => b - a); // ëª¨ë“  í’ˆëª© í‘œì‹œ
                
                const partNames = sortedData.map(([name]) => name);
                const usageData = sortedData.map(([, usage]) => usage);
                
                console.log('ì°¨íŠ¸ ë°ì´í„° - í’ˆëª…:', partNames);
                console.log('ì°¨íŠ¸ ë°ì´í„° - ì‚¬ìš©ëŸ‰:', usageData);
                
                // ì°¨íŠ¸ ì œëª©ì— í•„í„° ì •ë³´ í¬í•¨
                let chartTitle = `ğŸ¤– AI Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„ (${partNames.length}ê°œ í’ˆëª©)`;
                if (globalDateFilter.startDate || globalDateFilter.endDate) {
                    const startStr = globalDateFilter.startDate ? globalDateFilter.startDate.toLocaleDateString() : 'ì‹œì‘';
                    const endStr = globalDateFilter.endDate ? globalDateFilter.endDate.toLocaleDateString() : 'ì¢…ë£Œ';
                    chartTitle += ` [${startStr} ~ ${endStr}]`;
                }
                
                // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
                if (partNames.length === 0) {
                    integratedChart.setOption({
                        title: {
                            text: 'ì„ íƒ ê¸°ê°„ì— ì¶œê³  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤',
                            left: 'center',
                            textStyle: {
                                fontSize: 16,
                                color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                            }
                        },
                        series: []
                    });
                    return;
                }
                
                // 3D AI ë¯¸ë˜ì§€í–¥ì  ì°¨íŠ¸ ì˜µì…˜ ì„¤ì •
                integratedChart.setOption({
                    animation: true,
                    animationDuration: 2000,
                    animationEasing: 'cubicOut',
                    animationDelay: function (idx) {
                        return idx * 150;
                    },
                    backgroundColor: document.documentElement.classList.contains('dark') ? 
                        'transparent' : 'transparent',
                    title: {
                        text: chartTitle,
                        left: 'center',
                        top: '3%',
                        textStyle: {
                            fontSize: 18,
                            fontWeight: 'bold',
                            color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                            textShadowBlur: 10,
                            textShadowColor: document.documentElement.classList.contains('dark') ? 
                                'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                        }
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'shadow',
                            shadowStyle: {
                                color: 'rgba(0, 212, 255, 0.2)',
                                shadowBlur: 20,
                                shadowOffsetX: 5,
                                shadowOffsetY: 5
                            }
                        },
                        formatter: function(params) {
                            const data = params[0];
                            return `
                                <div style="
                                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                                    border: none;
                                    border-radius: 12px;
                                    padding: 12px;
                                    color: white;
                                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                                    backdrop-filter: blur(10px);
                                ">
                                    <div style="font-weight: bold; margin-bottom: 8px;">
                                        ğŸ¯ ${data.name}
                                    </div>
                                    <div style="display: flex; align-items: center;">
                                        <span style="margin-right: 8px;">ğŸ“Š</span>
                                        ì‚¬ìš©ëŸ‰: ${data.value}ê°œ
                                    </div>
                                </div>
                            `;
                        },
                        backgroundColor: 'transparent',
                        borderColor: 'transparent',
                        textStyle: {
                            color: '#ffffff'
                        }
                    },
                    grid: {
                        left: '8%',
                        right: '8%',
                        bottom: '15%',
                        top: '20%',
                        containLabel: true
                    },
                    xAxis: {
                        type: 'category',
                        data: partNames,
                        axisPointer: {
                            type: 'shadow'
                        },
                        axisLabel: {
                            rotate: 45,
                            interval: 0,
                            textStyle: {
                                fontSize: 11,
                                fontWeight: 'bold',
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                textShadowBlur: 3,
                                textShadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2,
                                shadowBlur: 10,
                                shadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                            }
                        },
                        axisTick: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2
                            }
                        }
                    },
                    yAxis: {
                        type: 'value',
                        name: 'ğŸ¤– AI ì‚¬ìš©ëŸ‰ ë¶„ì„ (ê°œ)',
                        nameTextStyle: {
                            color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                            fontSize: 13,
                            fontWeight: 'bold',
                            textShadowBlur: 5,
                            textShadowColor: document.documentElement.classList.contains('dark') ? 
                                'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                        },
                        axisLabel: {
                            formatter: '{value}',
                            textStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                fontSize: 11,
                                fontWeight: 'bold',
                                textShadowBlur: 3,
                                textShadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                            }
                        },
                        axisLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                width: 2,
                                shadowBlur: 10,
                                shadowColor: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.5)' : 'rgba(0, 102, 204, 0.3)',
                            }
                        },
                        splitLine: {
                            lineStyle: {
                                color: document.documentElement.classList.contains('dark') ? 
                                    'rgba(0, 212, 255, 0.1)' : 'rgba(0, 102, 204, 0.1)',
                                width: 1,
                                type: 'dashed'
                            }
                        }
                    },
                    series: [
                        {
                            name: 'ğŸ¤– AI ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ë¶„ì„',
                            type: 'bar',
                            data: usageData.map((value, index) => ({
                                value: value,
                                itemStyle: {
                                    // 3D ê·¸ë¼ë°ì´ì…˜ ìƒ‰ìƒ ë°°ì—´
                                    color: function() {
                                        const futuristicColors = [
                                            // ë„¤ì˜¨ ì‚¬ì´ë²„ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ff006e'},
                                                    {offset: 0.5, color: '#8338ec'},
                                                    {offset: 1, color: '#3a86ff'}
                                                ]
                                            },
                                            // í™€ë¡œê·¸ë¨ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#00f5ff'},
                                                    {offset: 0.5, color: '#00d4ff'},
                                                    {offset: 1, color: '#0066cc'}
                                                ]
                                            },
                                            // AI ê·¸ë¦° ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#39ff14'},
                                                    {offset: 0.5, color: '#00ff88'},
                                                    {offset: 1, color: '#00cc66'}
                                                ]
                                            },
                                            // í“¨ì²˜ ì˜¤ë Œì§€ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ff9500'},
                                                    {offset: 0.5, color: '#ff6b35'},
                                                    {offset: 1, color: '#e65100'}
                                                ]
                                            },
                                            // ë„¤ì˜¨ í¼í”Œ ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#d946ef'},
                                                    {offset: 0.5, color: '#a855f7'},
                                                    {offset: 1, color: '#7c3aed'}
                                                ]
                                            },
                                            // ì‚¬ì´ë²„ ì˜ë¡œìš° ê·¸ë¼ë°ì´ì…˜
                                            {
                                                type: 'linear',
                                                x: 0, y: 0, x2: 0, y2: 1,
                                                colorStops: [
                                                    {offset: 0, color: '#ffd60a'},
                                                    {offset: 0.5, color: '#ffbe0b'},
                                                    {offset: 1, color: '#fb8500'}
                                                ]
                                            }
                                        ];
                                        return futuristicColors[index % futuristicColors.length];
                                    }(),
                                    borderRadius: [8, 8, 0, 0],
                                    // 3D íš¨ê³¼ë¥¼ ìœ„í•œ ê°•ë ¥í•œ ê·¸ë¦¼ì
                                    shadowBlur: 25,
                                    shadowColor: 'rgba(0, 212, 255, 0.6)',
                                    shadowOffsetX: 8,
                                    shadowOffsetY: 12,
                                    // ë„¤ì˜¨ ë°œê´‘ íš¨ê³¼
                                    borderColor: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                    borderWidth: 2,
                                    // 3D ê¹Šì´ê°ì„ ìœ„í•œ opacity ë³€í™”
                                    opacity: 0.9
                                }
                            })),
                            emphasis: {
                                focus: 'series',
                                itemStyle: {
                                    shadowBlur: 40,
                                    shadowOffsetX: 12,
                                    shadowOffsetY: 18,
                                    shadowColor: 'rgba(0, 212, 255, 0.8)',
                                    borderWidth: 3,
                                    borderColor: '#ffffff',
                                    opacity: 1,
                                    // í˜¸ë²„ ì‹œ ìŠ¤ì¼€ì¼ ì—… íš¨ê³¼
                                    scale: 1.05
                                },
                                // 3D ë³€í˜• íš¨ê³¼
                                scaleSize: 8
                            },
                            barMaxWidth: 60,
                            // ë§‰ëŒ€ ê°„ê²© ì¡°ì •ìœ¼ë¡œ 3D íš¨ê³¼ ê°•í™”
                            barGap: '20%',
                            // ë§‰ëŒ€ ëª¨ì„œë¦¬ë¥¼ ë‘¥ê¸€ê²Œ ì²˜ë¦¬
                            barBorderRadius: [8, 8, 0, 0],
                            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ ì¶”ê°€
                            animationDuration: 2000,
                            animationEasing: 'elasticOut',
                            animationDelay: function (idx) {
                                return idx * 200;
                            },
                            // 3D ë¼ë²¨ íš¨ê³¼
                            label: {
                                show: true,
                                position: 'top',
                                formatter: 'ğŸš€ {c}',
                                textStyle: {
                                    color: document.documentElement.classList.contains('dark') ? '#00d4ff' : '#0066cc',
                                    fontSize: 12,
                                    fontWeight: 'bold',
                                    textShadowBlur: 8,
                                    textShadowColor: document.documentElement.classList.contains('dark') ? 
                                        'rgba(0, 212, 255, 0.8)' : 'rgba(0, 102, 204, 0.6)',
                                    textShadowOffsetX: 2,
                                    textShadowOffsetY: 2
                                }
                            },
                            // 3D ë°œê´‘ íš¨ê³¼ë¥¼ ìœ„í•œ markLine ì¶”ê°€
                            markLine: {
                                silent: true,
                                lineStyle: {
                                    color: document.documentElement.classList.contains('dark') ? 
                                        'rgba(0, 212, 255, 0.3)' : 'rgba(0, 102, 204, 0.2)',
                                    width: 1,
                                    type: 'dashed'
                                },
                                data: [
                                    {type: 'average', name: 'AI í‰ê· ê°’'}
                                ]
                            }
                        }
                    ],
                    // 3D íš¨ê³¼ë¥¼ ìœ„í•œ ì¶”ê°€ ì˜µì…˜
                    graphic: [
                        {
                            type: 'group',
                            left: 'center',
                            top: '5%',
                            children: [
                                {
                                    type: 'rect',
                                    z: 100,
                                    left: 'center',
                                    top: 'middle',
                                    shape: {
                                        width: 0,
                                        height: 0
                                    },
                                    style: {
                                        fill: 'transparent'
                                    }
                                }
                            ]
                        }
                    ]
                });
                
                console.log('3D AI Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                console.error('Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜:', error);
                
                // ì˜¤ë¥˜ ì°¨íŠ¸ í‘œì‹œ
                integratedChart.setOption({
                    title: {
                        text: 'ğŸ¤– AI ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤',
                        left: 'center',
                        textStyle: {
                            fontSize: 16,
                            color: '#ff4757'
                        }
                    },
                    series: []
                });
            }
        }

        // ì‚¬ìš©ì ì¸ì¦ í™•ì¸ í•¨ìˆ˜
        async function checkUserAuthentication() {
            try {
                console.log('ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘...');
                const authStatus = await window.partsAPI.checkAuthStatus();

                if (!authStatus.isAuthenticated) {
                    // ì¸ì¦ë˜ì§€ ì•Šì•˜ìœ¼ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    console.log('ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ì - ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');
                    window.location.href = 'login.html';
                    return;
                }

                // ì‚¬ìš©ì ì •ë³´ í‘œì‹œ
                const currentUserElement = document.getElementById('currentUser');
                if (currentUserElement && authStatus.user) {
                    currentUserElement.textContent = `${authStatus.user.username} (${authStatus.user.role})`;
                    console.log('ì‚¬ìš©ì ì •ë³´ í‘œì‹œë¨:', authStatus.user);
                }
            } catch (error) {
                console.error('ì¸ì¦ ìƒíƒœ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'login.html';
            }
        }

        // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
        async function logout() {
            try {
                console.log('ë¡œê·¸ì•„ì›ƒ ìš”ì²­...');
                const result = await window.partsAPI.userLogout();

                if (result.success) {
                    console.log('ë¡œê·¸ì•„ì›ƒ ì„±ê³µ');
                    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
                    window.location.href = 'login.html';
                } else {
                    console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', result.error);
                    alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜:', error);
                // ì˜¤ë¥˜ê°€ ìˆì–´ë„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
                window.location.href = 'login.html';
            }
        }

        document.addEventListener('DOMContentLoaded', async () => {
            console.log('DOMContentLoaded ì´ë²¤íŠ¸ ì‹¤í–‰');

            // ì¸ì¦ ìƒíƒœ í™•ì¸ ë° ì‚¬ìš©ì ì •ë³´ ë¡œë”©
            await checkUserAuthentication();

            // ë‚ ì§œ í•„í„° ì´ˆê¸°í™” (ë‹¤ë¥¸ ì´ˆê¸°í™”ë³´ë‹¤ ë¨¼ì € ì‹¤í–‰)
            setupDateFilter();
            
            // ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ ì´ˆê¸°í™”
            const darkModeToggle = document.getElementById('darkModeToggle');
            console.log('ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼:', darkModeToggle);

            if (darkModeToggle) {
                // ê¸°ì¡´ í•¸ë“¤ëŸ¬ ì œê±° (ì´ì¤‘ ë“±ë¡ ë°©ì§€)
                darkModeToggle.onclick = null;
                
                // ìƒˆ í•¸ë“¤ëŸ¬ ë“±ë¡
                darkModeToggle.onclick = function() {
                    console.log('ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼ í´ë¦­ë¨');
                    
                    // í˜„ì¬ í…Œë§ˆ í™•ì¸
                    const isDarkMode = document.documentElement.classList.contains('dark');
                    console.log('í˜„ì¬ ë‹¤í¬ëª¨ë“œ ìƒíƒœ:', isDarkMode);
                    
                    // ì•„ì´ì½˜ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
                    const moonIcon = document.getElementById('moonIcon');
                    const sunIcon = document.getElementById('sunIcon');
                    
                    if (isDarkMode) {
                        // ë‹¤í¬ëª¨ë“œ -> ë¼ì´íŠ¸ëª¨ë“œ ì „í™˜
                        document.documentElement.classList.remove('dark');
                        localStorage.theme = 'light';
                        console.log('ë¼ì´íŠ¸ ëª¨ë“œë¡œ ì „í™˜ë¨');
                        
                        // ì•„ì´ì½˜ ì „í™˜: ë‹¬ í‘œì‹œ, í•´ ìˆ¨ê¹€
                        moonIcon.style.display = 'inline-block';
                        sunIcon.style.display = 'none';
                    } else {
                        // ë¼ì´íŠ¸ëª¨ë“œ -> ë‹¤í¬ëª¨ë“œ ì „í™˜
                        document.documentElement.classList.add('dark');
                        localStorage.theme = 'dark';
                        console.log('ë‹¤í¬ ëª¨ë“œë¡œ ì „í™˜ë¨');
                        
                        // ì•„ì´ì½˜ ì „í™˜: ë‹¬ ìˆ¨ê¹€, í•´ í‘œì‹œ
                        moonIcon.style.display = 'none';
                        sunIcon.style.display = 'inline-block';
                    }
                      // ì—¬ê¸°ì— ì°¨íŠ¸ ì—…ë°ì´íŠ¸ ì½”ë“œ ì¶”ê°€
                    updateStockChart();
                    updateFlowChart(); // ì´ ì¤„ ì¶”ê°€
                    updateBoardUsageChart();
                };
            }
               
            // ì°¨íŠ¸ ì´ˆê¸°í™”
            const stockChart = echarts.init(document.getElementById('stockChart'));
            const flowChart = echarts.init(document.getElementById('flowChart'));
            
            // ì¬ê³  í˜„í™© ì°¨íŠ¸ ì´ˆê¸° ì„¤ì • (ë°ì´í„° ë¡œë”© ì „ í‘œì‹œ)
            stockChart.setOption({
                animation: false,
                tooltip: {
                    trigger: 'item'
                },
                series: [{
                    type: 'pie',
                    radius: ['40%', '70%'],
                    data: [
                        { value: 1, name: 'ë°ì´í„° ë¡œë”© ì¤‘...' }
                    ],
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }]
            });

            // ì‹¤ì œ ë°ì´í„°ë¡œ ì¬ê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            await updateStockChart();
            
            // ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì´ˆê¸° ì„¤ì • (ë°ì´í„° ë¡œë”© ì „ í‘œì‹œ)
            flowChart.setOption({
                animation: false,
                title: {
                    text: 'ë°ì´í„° ë¡œë”© ì¤‘...',
                    left: 'center',
                    textStyle: {
                        fontSize: 14,
                        color: document.documentElement.classList.contains('dark') ? '#ffffff' : '#333333'
                    }
                }
            });

            // ì‹¤ì œ ë°ì´í„°ë¡œ ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            await updateFlowChart();
            
            // ì°½ í¬ê¸° ë³€ê²½ ì‹œ ì°¨íŠ¸ í¬ê¸° ì¡°ì •
            window.addEventListener('resize', function() {
                stockChart.resize();
                flowChart.resize();
            });
            
            // ëª¨ë‹¬ ê´€ë ¨ ê¸°ëŠ¥
            const modal = document.getElementById('modal');
            const openModalButton = document.getElementById('openModalButton');
            const cancelButton = document.getElementById('cancelButton');
            const partForm = document.getElementById('partForm');
            
            if (openModalButton) {
                openModalButton.addEventListener('click', () => {
                    modal.classList.remove('hidden');
                });
            }
            
            if (cancelButton) {
                cancelButton.addEventListener('click', () => {
                    modal.classList.add('hidden');
                });
            }
            
            if (partForm) {
                partForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // í¼ ì²˜ë¦¬ ì½”ë“œ...
                    modal.classList.add('hidden');
                    partForm.reset();
                });
            }
            
            // ë¡œê³  ì´ë¯¸ì§€ í´ë¦­ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
            const homeRefreshButton = document.getElementById('homeRefreshButton');
            if (homeRefreshButton) {
                homeRefreshButton.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨');
                    window.location.reload(true);
                });
            }

            // ì‹¤ì‹œê°„ ì•Œë¦¼ ì—…ë°ì´íŠ¸
            await updateAlerts();

            // ì•Œë¦¼ ë²„íŠ¼ ë° ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
            setupNotifications();

            // ë©”ì‹ ì € ê¸°ëŠ¥ ì´ˆê¸°í™” (ì´ ë¶€ë¶„ì„ ì¶”ê°€)
            setupMessenger();            // ì±„íŒ… íˆìŠ¤í† ë¦¬ í…Œì´ë¸” ì´ˆê¸°í™” ë° í•„í„° ì„¤ì • (ì´ ë¶€ë¶„ ì¶”ê°€)
            await updateChatHistoryTable();
            setupChatHistoryFilter();

            // Boardë³„ ë¶€í’ˆ ì‚¬ìš©ëŸ‰ ì°¨íŠ¸ ë° í•„í„° ì´ˆê¸°í™”
            await initializeBoardUsageFilters();
            await updateBoardUsageChart();

            // í•„í„° ì ìš© ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
            const applyFilterButton = document.getElementById('applyBoardFilter');
            if (applyFilterButton) {
                applyFilterButton.addEventListener('click', applyBoardUsageFilter);
                console.log('í•„í„° ì ìš© ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€ë¨');
            }

            // ì±„íŒ… íˆìŠ¤í† ë¦¬ í•„í„°ë§ ì´ˆê¸°í™”
            setupChatHistoryFilter();

            // ì±„íŒ… íˆìŠ¤í† ë¦¬ í…Œì´ë¸” ì—…ë°ì´íŠ¸
            await updateChatHistoryTable();

            // ì…ì¶œê³  í˜„í™© ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            await updateFlowChart();
            
            // ì´ˆê¸° ì°¨íŠ¸ ì—…ë°ì´íŠ¸ (ë‚ ì§œ í•„í„°ì™€ í•¨ê»˜)
            await updateAllChartsWithDateFilter();
        });

        // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' || e.keyCode === 27) {
                // ì±—ë´‡ ëª¨ë‹¬ ë‹«ê¸°
                const chatModal = document.getElementById('chatModal');
                if (chatModal && !chatModal.classList.contains('hidden')) {
                    chatModal.classList.add('hidden');
                }
            }
        });
    </script>
</body>
</html>
